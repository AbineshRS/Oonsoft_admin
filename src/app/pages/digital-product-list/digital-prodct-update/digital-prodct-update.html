<!-- Blurred Backdrop -->
<div *ngIf="listofProduct" class="fixed inset-0 z-40 backdrop-blur-sm bg-black/30" (click)="onClose()"></div>

<!-- Right Drawer -->
<div *ngIf="listofProduct"
  class="fixed inset-y-0 right-0 w-full sm:w-[600px] bg-white shadow-lg z-50 p-6 overflow-y-auto">
  <!-- Close Button -->
  <button (click)="onClose()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 z-50">âœ•</button>

  <h2 class="text-xl font-semibold text-gray-800 mt-8 mb-6">ğŸ“ Edit Product Details</h2>

  <!-- Image Preview -->
  <div class="flex justify-center mb-6">
    <img *ngIf="imagePreviewUrl || listofProduct.im_ProductImages?.[0]?.image_url"
      [src]="imagePreviewUrl || (baseUrl + listofProduct.im_ProductImages[0]?.image_url)" alt="Product Image"
      class="w-40 h-40 object-cover rounded-lg border shadow-md" />
  </div>

  <!-- Form -->
  <form #productForm="ngForm" (ngSubmit)="onSave()" novalidate class="space-y-4 text-sm text-gray-700">
    <!-- Title -->
    <div>
      <label class="block text-gray-600 font-medium mb-1">Title</label>
      <input [(ngModel)]="listofProduct.title" name="title" required #title="ngModel"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring" placeholder="Enter title" />
      <div *ngIf="title.invalid && title.touched" class="text-red-600 text-xs mt-1">Title is required.</div>
    </div>

    <!-- Description -->
    <div>
      <label class="block text-gray-600 font-medium mb-1">Description</label>
      <textarea [(ngModel)]="listofProduct.description" name="description" required #description="ngModel" rows="3"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring"
        placeholder="Enter description"></textarea>
      <div *ngIf="description.invalid && description.touched" class="text-red-600 text-xs mt-1">
        Description is required.
      </div>
    </div>

    <!-- Brand -->
    <div>
      <label class="block text-gray-600 font-medium mb-1">Brand</label>
      <input [(ngModel)]="listofProduct.brand" name="brand" required #brand="ngModel"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring" placeholder="Enter brand" />
      <div *ngIf="brand.invalid && brand.touched" class="text-red-600 text-xs mt-1">Brand is required.</div>
    </div>

    <!-- Price -->
    <div>
      <label class="block text-gray-600 font-medium mb-1">Price ($)</label>
      <input type="number" [(ngModel)]="listofProduct.price" name="price" required min="0.01" #price="ngModel"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring" placeholder="Enter price" />
      <div *ngIf="price.invalid && price.touched" class="text-red-600 text-xs mt-1">
        Valid price is required (greater than 0).
      </div>
    </div>

    <!-- Stock Quantity -->
    <div>
      <label class="block text-gray-600 font-medium mb-1">Stock Quantity</label>
      <input type="number" [(ngModel)]="listofProduct.stock_quantity" name="stock_quantity" min="0" required
        #stock_quantity="ngModel" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring"
        placeholder="Enter quantity" />
      <div *ngIf="stock_quantity.invalid && stock_quantity.touched" class="text-red-600 text-xs mt-1">
        Quantity is required and must be 0 or more.
      </div>
    </div>

    <!-- Image Upload -->
    <div>
      <label class="block text-gray-600 font-medium mb-1">Upload New Image</label>
      <input type="file" accept="image/*" (change)="onImageSelected($event)"
        class="w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
    </div>
    <div>
      <label class="block text-gray-600 font-medium mb-1">Status </label>
     <label class="flex items-center cursor-pointer">
        <!-- Label Text (changes based on status) -->
        <span class="mr-3 text-sm font-medium" [ngClass]="{
        'text-green-600': listofProduct.status === 'T',
        'text-red-500': listofProduct.status === 'F'
      }">
          {{ listofProduct.status === 'T' ? 'Active' : 'Inactive' }}
        </span>

        <!-- Toggle Input -->
        <div class="relative">
          <input type="checkbox" class="sr-only" [checked]="listofProduct.status === 'T'"
            (change)="toggleStatus($event)" />
          <!-- Toggle Track -->
          <div class="w-11 h-6 bg-gray-300 rounded-full shadow-inner transition-colors duration-300"
            [ngClass]="{ 'bg-green-500': listofProduct.status === 'T', 'bg-red-400': listofProduct.status === 'F' }">
          </div>
          <!-- Toggle Dot -->
          <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition transform duration-300"
            [ngClass]="{ 'translate-x-5': listofProduct.status === 'T' }">
          </div>
        </div>
     </label>
    </div>
  
    <!-- Save Button -->
    <div class="pt-6 text-right">
      <button type="submit" [disabled]="productForm.invalid || loading"
        class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2">

        <svg *ngIf="loading" class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
          viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>

        <span>ğŸ’¾ Save Changes</span>
      </button>

    </div>
  </form>
</div>